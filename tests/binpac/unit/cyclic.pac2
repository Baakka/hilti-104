#
# @TEST-EXEC:  printf '\x02\x80\x81\x00\xff12345\x03\x10\x11\x12\xfe\xffABCDE' | pac-driver-test %INPUT >output    
# @TEST-EXEC:  btest-diff output
#
# DNS-like madness.

module Test;

export type Packet = unit() {
    data: bytes &length=10;
    name: Name(self);
    data2: bytes &length=5;

    on %done { print self; }
};

type Name = unit(p: Packet) {
    labels: list<Label(p)> &until($$.len == 0 || $$.len == 255);
};

type Label = unit(p: Packet) {
    len: uint8;

    switch ( self.len ) {
        254 -> n1: Name(p) &parse(p.input());
        255 -> n2: Name(p) &parse(p.input());
        *   -> l: bytes &length=self.len;
    };
};
