module Main

import Hilti

int<32> fibo(int<32> n)
{

  local int<32> f1
  local int<32> f2
  local bool cond
  
  
      # pred: { <none> } succ: { [0052] }
      # def: { fibo%cond.2 } clear: { <none> } mod: { p:n } read: { <none> }
      # live-in: { p:n } live-out: { fibo%cond.2, p:n }
      # now-dead: { <none> }
      [0051] cond = int.slt n 2
      # pred: { [0051] } succ: { [0054], [0061] }
      # def: { <none> } clear: { <none> } mod: { fibo%cond.2 } read: { <none> }
      # live-in: { fibo%cond.2, p:n } live-out: { p:n }
      # now-dead: { fibo%cond.2 }
      [0052] if.else cond @done @recurse
  
  @recurse:
      # pred: { [0052] } succ: { [0055] }
      # def: { p:n } clear: { <none> } mod: { p:n } read: { <none> }
      # live-in: { p:n } live-out: { p:n }
      # now-dead: { <none> }
      [0054] n = int.sub n 1
      # pred: { [0054] } succ: { [0056] }
      # def: { fibo%f1.2 } clear: { <none> } mod: { p:n } read: { <none> }
      # live-in: { p:n } live-out: { fibo%f1.2, p:n }
      # now-dead: { <none> }
      [0055] f1 = call fibo (n)
      # pred: { [0055] } succ: { [0057] }
      # def: { p:n } clear: { <none> } mod: { p:n } read: { <none> }
      # live-in: { fibo%f1.2, p:n } live-out: { fibo%f1.2, p:n }
      # now-dead: { <none> }
      [0056] n = int.sub n 1
      # pred: { [0056] } succ: { [0058] }
      # def: { fibo%f2.2 } clear: { <none> } mod: { p:n } read: { <none> }
      # live-in: { fibo%f1.2, p:n } live-out: { fibo%f1.2, fibo%f2.2 }
      # now-dead: { p:n }
      [0057] f2 = call fibo (n)
      # pred: { [0057] } succ: { [0059] }
      # def: { fibo%f1.2 } clear: { <none> } mod: { fibo%f1.2, fibo%f2.2 } read: { <none> }
      # live-in: { fibo%f1.2, fibo%f2.2 } live-out: { fibo%f1.2 }
      # now-dead: { fibo%f2.2 }
      [0058] f1 = int.add f1 f2
      # pred: { [0058] } succ: { <none> }
      # def: { <none> } clear: { <none> } mod: { fibo%f1.2 } read: { <none> }
      # live-in: { fibo%f1.2 } live-out: { <none> }
      # now-dead: { fibo%f1.2 }
      [0059] return.result f1
  
  @done:
      # pred: { [0052] } succ: { <none> }
      # def: { <none> } clear: { <none> } mod: { p:n } read: { <none> }
      # live-in: { p:n } live-out: { <none> }
      # now-dead: { p:n }
      [0061] return.result n
  
}


void run()
{

  local int<32> f
  
  
      # pred: { <none> } succ: { [0064] }
      # def: { run%f.2 } clear: { <none> } mod: { <none> } read: { <none> }
      # live-in: { <none> } live-out: { run%f.2 }
      # now-dead: { <none> }
      [0063] f = call fibo (10)
      # pred: { [0063] } succ: { [0065] }
      # def: { <none> } clear: { <none> } mod: { run%f.2 } read: { <none> }
      # live-in: { run%f.2 } live-out: { <none> }
      # now-dead: { run%f.2 }
      [0064] call Hilti::print (f)
      # pred: { [0064] } succ: { <none> }
      # def: { <none> } clear: { <none> } mod: { <none> } read: { <none> }
      # live-in: { <none> } live-out: { <none> }
      # now-dead: { <none> }
      [0065] return.void
  
}



  # pred: { <none> } succ: { <none> }
  # def: { <none> } clear: { <none> } mod: { <none> } read: { <none> }
  # live-in: { <none> } live-out: { <none> }
  # now-dead: { <none> }
  [0068] block.end

